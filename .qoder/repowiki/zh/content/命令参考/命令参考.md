# 命令参考

<cite>
**本文档中引用的文件**  
- [extensions.tsx](file://packages/cli/src/commands/extensions.tsx)
- [hooks.tsx](file://packages/cli/src/commands/hooks.tsx)
- [mcp.ts](file://packages/cli/src/commands/mcp.ts)
- [BuiltinCommandLoader.ts](file://packages/cli/src/services/BuiltinCommandLoader.ts)
- [CommandService.ts](file://packages/cli/src/services/CommandService.ts)
- [helpCommand.ts](file://packages/cli/src/ui/commands/helpCommand.ts)
- [memoryCommand.ts](file://packages/cli/src/ui/commands/memoryCommand.ts)
- [statsCommand.ts](file://packages/cli/src/ui/commands/statsCommand.ts)
- [settingsCommand.ts](file://packages/cli/src/ui/commands/settingsCommand.ts)
- [toolsCommand.ts](file://packages/cli/src/ui/commands/toolsCommand.ts)
- [sessionCommand.ts](file://packages/cli/src/ui/commands/sessionCommand.ts)
</cite>

## 目录
1. [简介](#简介)
2. [会话管理命令](#会话管理命令)
3. [工具管理命令](#工具管理命令)
4. [系统信息与状态命令](#系统信息与状态命令)
5. [设置与配置命令](#设置与配置命令)
6. [高级使用技巧](#高级使用技巧)

## 简介
本参考文档详细介绍了Gemini CLI提供的所有内置命令。这些命令通过斜杠语法（如`/help`）调用，为用户提供了一套强大的交互式功能，用于管理会话、查看状态、配置设置和与工具交互。命令系统采用模块化设计，核心功能由内置命令提供，同时支持通过扩展和钩子进行功能增强。本文档将按功能类别组织，为每个命令提供详细的用途说明、语法、参数、返回值、使用示例以及内部实现机制。

**Section sources**
- [BuiltinCommandLoader.ts](file://packages/cli/src/services/BuiltinCommandLoader.ts#L12-L97)

## 会话管理命令

### `/help` 命令
显示帮助信息，引导用户了解CLI的基本用法。

- **用途**: 提供CLI的使用指南和命令概览。
- **语法**: `/help` 或 `/?`
- **参数**: 无
- **返回值**: 在UI中显示一个帮助信息项。
- **权限要求**: 无
- **错误状态**: 无
- **使用示例**:
  ```bash
  /help
  ```
- **内部实现**: 该命令创建一个类型为`MessageType.HELP`的历史记录项，并通过`context.ui.addItem`方法将其添加到用户界面中。

**Section sources**
- [helpCommand.ts](file://packages/cli/src/ui/commands/helpCommand.ts#L11-L25)

### `/session` 命令
管理当前会话的状态，包括保存、恢复和清除会话数据。

- **用途**: 允许用户保存当前会话以便后续恢复，或清除当前会话上下文。
- **语法**: `/session <subcommand>`
- **子命令**:
  - `save`: 保存当前会话。
  - `restore`: 恢复先前保存的会话。
  - `clear`: 清除当前会话的所有上下文。
- **参数**: 子命令名称。
- **返回值**: 执行相应的会话管理操作，并在UI中反馈结果。
- **权限要求**: 无
- **错误状态**: 如果会话持久化失败，会显示错误信息。
- **使用示例**:
  ```bash
  /session save
  /session restore
  ```
- **内部实现**: 该命令通过`context.services.session`服务与会话管理模块交互，调用其`save`、`restore`和`clear`方法来执行具体操作。

**Section sources**
- [sessionCommand.ts](file://packages/cli/src/ui/commands/sessionCommand.ts)

## 工具管理命令

### `/tool` 命令
与CLI的工具系统进行交互，用于列出、启用或禁用可用的工具。

- **用途**: 管理CLI可以调用的外部工具（如文件系统操作、shell命令执行等）。
- **语法**: `/tool <subcommand>`
- **子命令**:
  - `list`: 列出所有已注册的工具。
  - `enable <tool-name>`: 启用指定的工具。
  - `disable <tool-name>`: 禁用指定的工具。
- **参数**: 子命令及可选的工具名称。
- **返回值**: 执行工具管理操作，并在UI中显示结果。
- **权限要求**: 某些工具（如shell执行）可能需要明确的用户授权。
- **错误状态**: 如果指定的工具不存在或操作被策略引擎阻止，会返回错误。
- **使用示例**:
  ```bash
  /tool list
  /tool disable shell
  ```
- **内部实现**: 该命令通过`context.services.tool`服务与核心工具调度器（`coreToolScheduler`）交互，查询工具注册表并修改工具的启用状态。

**Section sources**
- [toolsCommand.ts](file://packages/cli/src/ui/commands/toolsCommand.ts)

## 系统信息与状态命令

### `/memory` 命令
与核心的内存管理工具交互，用于查看、添加和刷新持久化记忆。

- **用途**: 管理CLI的长期记忆，这些记忆通常来自项目根目录下的`GEMINI.md`文件。
- **语法**: `/memory <subcommand>`
- **子命令**:
  - `show`: 显示当前内存内容。
  - `add <text>`: 将指定文本添加到记忆中。
  - `refresh`: 从源文件重新加载内存。
  - `list`: 列出所有被使用的`GEMINI.md`文件的路径。
- **参数**: 子命令及可选的文本内容。
- **返回值**: 执行内存操作，并在UI中显示结果或触发工具调用。
- **权限要求**: 无
- **错误状态**: `refresh`操作可能因文件读取错误而失败。
- **使用示例**:
  ```bash
  /memory show
  /memory add 项目的关键目标是提高用户留存率。
  /memory refresh
  ```
- **内部实现**: `show`和`list`子命令直接从`context.services.config`中读取内存内容和文件路径。`add`子命令返回一个`save_memory`工具调用。`refresh`子命令调用核心模块的`refreshServerHierarchicalMemory`函数来重新解析`GEMINI.md`文件。

**Section sources**
- [memoryCommand.ts](file://packages/cli/src/ui/commands/memoryCommand.ts#L15-L144)

### `/stats` 命令
检查会话、模型和工具的使用统计信息。

- **用途**: 提供关于当前会话时长、配额使用情况和工具调用次数的详细信息。
- **语法**: `/stats [session|model|tools]`
- **参数**: 可选的统计类别（默认为`session`）。
- **返回值**: 在UI中显示相应的统计信息卡片。
- **权限要求**: 无
- **错误状态**: 获取配额信息时可能因网络问题或认证失败而报错。
- **使用示例**:
  ```bash
  /stats
  /stats model
  /stats tools
  ```
- **内部实现**: 该命令根据子命令调用不同的UI类型。`session`视图计算会话持续时间并尝试从`CodeAssistServer`获取用户的配额信息。`model`和`tools`视图则触发UI显示相应的统计面板。

**Section sources**
- [statsCommand.ts](file://packages/cli/src/ui/commands/statsCommand.ts#L50-L98)

## 设置与配置命令

### `/settings` 命令
查看和编辑Gemini CLI的设置。

- **用途**: 打开设置对话框，允许用户修改各种配置选项。
- **语法**: `/settings`
- **参数**: 无
- **返回值**: 返回一个打开设置对话框的动作。
- **权限要求**: 无
- **错误状态**: 无
- **使用示例**:
  ```bash
  /settings
  ```
- **内部实现**: 该命令的`action`函数返回一个类型为`dialog`且`dialog`字段为`settings`的对象，UI层会监听此动作并显示设置对话框。

**Section sources**
- [settingsCommand.ts](file://packages/cli/src/ui/commands/settingsCommand.ts#L10-L18)

## 高级使用技巧

### 命令组合
高级用户可以通过组合多个命令来完成复杂任务。例如，可以先使用`/memory refresh`确保记忆是最新的，然后使用`/stats`检查当前的配额使用情况，最后使用`/tool list`确认所有必要的工具都已启用，再开始一个复杂的自动化任务。

### 权限与策略
命令的执行可能受到策略引擎的控制。例如，`/tool disable shell`可以禁用shell工具以提高安全性。管理员可以通过配置文件定义更复杂的策略，这些策略会在命令执行前由`policy-engine`进行评估。

### 扩展与钩子
除了内置命令，用户还可以通过`/extensions`命令管理扩展，通过`/hooks`命令管理钩子。这些机制允许在命令执行的各个阶段（如`before-model`、`after-tool`）注入自定义逻辑，从而实现高度定制化的自动化流程。